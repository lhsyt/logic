<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ€ç»´è¿›åŒ–è®­ç»ƒè¥ | Logic Master</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #050505;
            --card-bg: #121212;
            --text-main: #ffffff;
            --text-sub: #888888;
            --accent-blue: #3b82f6; 
            --accent-purple: #8b5cf6;
            --glow: rgba(59, 130, 246, 0.6);
            --gold: #f59e0b;
            --input-bg: #1a1a1a;
            --border: #2a2a2a;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Noto Sans SC', -apple-system, Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* é¡¶éƒ¨æ°›å›´å…‰ */
        body::before {
            content: ''; position: fixed; top: -20%; left: 50%; transform: translateX(-50%);
            width: 120%; height: 60%; 
            background: radial-gradient(circle, rgba(59,130,246,0.15) 0%, rgba(0,0,0,0) 70%);
            pointer-events: none; z-index: -1;
        }

        .container { width: 100%; max-width: 600px; padding: 20px 16px 80px; flex: 1; }

        /* === 1. Hero å¤´éƒ¨ === */
        .hero-section { text-align: center; margin-bottom: 30px; margin-top: 20px; }
        .hero-subtitle { color: var(--accent-blue); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; letter-spacing: 2px; font-weight: 800; text-transform: uppercase; margin-bottom: 12px; text-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        .hero-title { font-size: 2.2rem; line-height: 1.2; font-weight: 900; margin-bottom: 16px; color: #fff; }
        .hero-title .highlight { background: linear-gradient(90deg, #60a5fa 0%, #a78bfa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 2.4rem; display: block; margin-top: 4px; }
        .hero-desc { font-size: 0.85rem; color: var(--text-sub); margin-bottom: 24px; line-height: 1.6; padding: 0 20px; }

        /* è¿›åº¦æ¡ */
        .progress-box { padding: 0 10px; }
        .progress-header { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-sub); margin-bottom: 8px; font-weight: 600; }
        .progress-track { background: #1f1f1f; height: 12px; border-radius: 6px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.5); }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-blue), #8b5cf6); width: 0%; transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1); box-shadow: 0 0 10px rgba(139, 92, 246, 0.4); }

        /* === 2. åœ†å½¢ Tab å¯¼èˆª === */
        .nav-tabs { display: flex; justify-content: space-between; gap: 12px; margin-bottom: 24px; margin-top: 10px; }
        .nav-item { flex: 1; background: #161616; border: 1px solid #2a2a2a; border-radius: 16px; padding: 16px 0; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.3s; position: relative; overflow: hidden; }
        .nav-item.active { background: var(--accent-blue); border-color: var(--accent-blue); box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4); }
        .nav-item.active .tab-week { color: rgba(255,255,255,0.8); }
        .nav-item.active .tab-num { color: #fff; }
        .tab-week { font-size: 0.7rem; font-weight: 700; color: #666; margin-bottom: 4px; text-transform: uppercase; }
        .tab-num { font-size: 1.4rem; font-weight: 900; color: #fff; font-family: 'JetBrains Mono'; line-height: 1; }

        /* === 3. å¯¼è¯­å¡ç‰‡ (Banner) === */
        .week-banner { background: linear-gradient(145deg, #1a1a2e, #16213e); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 16px; padding: 24px; margin-bottom: 24px; position: relative; overflow: hidden; animation: slideUp 0.4s ease-out; min-height: 120px; }
        .week-banner::after { content: ''; position: absolute; right: -10px; bottom: -30px; width: 100px; height: 100px; background: rgba(59, 130, 246, 0.1); border-radius: 50%; filter: blur(20px); }
        .banner-tag { background: rgba(255,255,255,0.1); color: #a5b4fc; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 700; display: inline-block; margin-bottom: 12px; }
        .banner-title { font-size: 1.3rem; font-weight: 800; color: #fff; margin-bottom: 8px; }
        .banner-desc { font-size: 0.85rem; color: #94a3b8; line-height: 1.5; }

        /* ä»»åŠ¡å¡ç‰‡ */
        .grid { display: grid; gap: 12px; display: none; }
        .grid.active { display: grid; animation: fadeIn 0.5s; }
        .card { background: #111; border: 1px solid #222; border-radius: 12px; padding: 18px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s; position: relative; }
        .card:active { transform: scale(0.98); background: #1a1a1a; }
        .card-left { display: flex; align-items: center; gap: 15px; }
        .day-badge { font-family: 'JetBrains Mono'; font-size: 0.75rem; color: #666; font-weight: 700; background: #1a1a1a; padding: 6px 8px; border-radius: 6px; min-width: 60px; text-align: center; }
        .card.completed .day-badge { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .card-title { font-size: 1rem; font-weight: 600; color: #eee; }
        .check-icon { width: 24px; height: 24px; border: 2px solid #444; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .card.completed .check-icon { border-color: var(--success); background: var(--success); }
        .card.completed .check-icon::after { content: 'âœ“'; color: #000; font-weight: 900; font-size: 14px; }

        /* Footer */
        footer { width: 100%; text-align: center; padding: 40px 0 60px; border-top: 1px solid #222; margin-top: auto; }
        .data-btn-group { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .pill-btn { background: #1a1a1a; border: 1px solid #333; color: #ccc; padding: 10px 20px; border-radius: 30px; font-size: 0.85rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: 0.2s; }
        .pill-btn:active { background: #222; transform: scale(0.95); }
        
        .danger-zone { margin-top: 40px; margin-bottom: 20px; padding-top: 20px; border-top: 1px dashed #333; width: 80%; margin-left: auto; margin-right: auto; }
        .btn-reset { background: transparent; border: 1px solid var(--danger); color: var(--danger); padding: 8px 16px; border-radius: 30px; font-size: 0.75rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 4px; transition: 0.2s; opacity: 0.7; }
        .btn-reset:hover { opacity: 1; background: rgba(239, 68, 68, 0.1); }
        
        .copyright { font-size: 0.7rem; color: #444; letter-spacing: 1px; }

        /* Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); z-index: 100; display: none; justify-content: center; align-items: end; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.open { display: flex; opacity: 1; }
        .modal-content { background: #161616; width: 100%; max-width: 600px; height: 92vh; border-radius: 24px 24px 0 0; border-top: 1px solid #333; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 -10px 40px rgba(0,0,0,0.8); }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 1.2rem; font-weight: 800; color: #fff; font-family: 'JetBrains Mono'; }
        .close-btn { background: none; border: none; color: #666; font-size: 28px; padding: 0; cursor: pointer; }
        .modal-body { flex: 1; overflow-y: auto; padding: 24px; padding-bottom: 60px; -webkit-overflow-scrolling: touch; }
        
        .section-label { font-size: 0.75rem; color: var(--accent-blue); font-weight: 800; text-transform: uppercase; margin: 24px 0 10px; letter-spacing: 1px; }
        .section-label:first-child { margin-top: 0; }
        
        .task-box { background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); padding: 16px; border-radius: 12px; color: #e2e8f0; font-size: 0.95rem; line-height: 1.6; white-space: pre-wrap; }
        .example-box { background: #0a0a0a; padding: 16px; border-radius: 12px; margin-top: 12px; font-size: 0.85rem; border-left: 3px solid var(--gold); }
        
        .homework-area, .revision-area { width: 100%; min-height: 150px; background: #0a0a0a; color: #fff; border: 1px solid #333; border-radius: 12px; padding: 16px; font-family: inherit; font-size: 16px; line-height: 1.6; resize: none; outline: none; margin-bottom: 8px; }
        .homework-area:focus, .revision-area:focus { border-color: var(--accent-blue); }
        .revision-area { background: #1a1500; border-color: rgba(245, 158, 11, 0.3); }
        .revision-area:focus { border-color: var(--gold); }
        .ai-prompt-box { background: #0d1117; border: 1px dashed #30363d; padding: 16px; border-radius: 12px; margin-top: 20px; display: none; }
        .ai-prompt-content { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: #8b949e; white-space: pre-wrap; line-height: 1.5; max-height: 150px; overflow-y: auto; }
        .btn-ai-gen { background: linear-gradient(90deg, #3b82f6, #8b5cf6); border: none; color: white; padding: 14px; border-radius: 12px; font-size: 0.95rem; font-weight: 700; width: 100%; margin-top: 15px; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-secondary { background: #21262d; color: #c9d1d9; border: 1px solid #30363d; padding: 10px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.85rem; }
        .btn-report { background: linear-gradient(90deg, #f59e0b, #d97706); color: #000; border: none; padding: 14px; border-radius: 12px; font-size: 1rem; font-weight: 800; width: 100%; margin-top: 30px; cursor: pointer; }
        
        .report-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 200; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .report-overlay.show { display: flex; }
        .report-img { max-width: 90%; max-height: 80vh; border-radius: 12px; border: 1px solid #333; }
        .report-close { position: absolute; top: 20px; right: 20px; color: #fff; font-size: 30px; cursor: pointer; z-index: 201; }
        .report-tip { color: var(--gold); margin-top: 20px; font-size: 0.8rem; font-weight: 600; animation: pulse 2s infinite; }
        #canvas-buffer { display: none; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
    </style>
</head>
<body>

    <div class="container">
        <div class="hero-section">
            <div class="hero-subtitle">21-DAY EVOLUTION</div>
            <div class="hero-title">
                ä»â€œè¯­æ— ä¼¦æ¬¡â€åˆ°<span class="highlight">â€œé€»è¾‘å¤§ç¥â€</span>
            </div>
            <div class="hero-desc">
                21å¤©æ€ç»´è¡¨è¾¾è¿›åŒ–è®­ç»ƒè¥ï¼šå…ˆè¯´äººè¯ï¼Œå†è¯´ç»“æ„ï¼Œæœ€åæ´å¯Ÿã€‚
            </div>
            
            <div class="progress-box">
                <div class="progress-header">
                    <span>æ€»è¿›åº¦</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="progress-bar"></div>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="nav-item active" onclick="switchWeek(1)" id="tab-1">
                <div class="tab-week">Week</div>
                <div class="tab-num">1</div>
            </div>
            <div class="nav-item" onclick="switchWeek(2)" id="tab-2">
                <div class="tab-week">Week</div>
                <div class="tab-num">2</div>
            </div>
            <div class="nav-item" onclick="switchWeek(3)" id="tab-3">
                <div class="tab-week">Week</div>
                <div class="tab-num">3</div>
            </div>
        </div>

        <div id="week-banner" class="week-banner"></div>

        <div id="content-area"></div>
    </div>

    <footer>
        <div class="data-btn-group">
            <button class="pill-btn" onclick="copyDataString(this)">
                <span style="color:#f59e0b">ğŸ“‹</span> å¤‡ä»½è¿›åº¦
            </button>
            <button class="pill-btn" onclick="pasteDataString()">
                <span style="color:#a78bfa">ğŸ“¥</span> æ¢å¤è¿›åº¦
            </button>
        </div>
        <div style="font-size: 0.75rem; color: #666; margin-bottom:10px">*æœ¬åœ°ç¦»çº¿ç³»ç»Ÿï¼Œè¯·è®°å¾—å®šæœŸå¤‡ä»½</div>

        <div class="danger-zone">
            <button class="btn-reset" onclick="resetData()">
                <span>â†»</span> æ¸…ç©ºè®°å½•é‡æ–°å¼€å§‹
            </button>
        </div>

        <div class="copyright">Â© èˆŸèˆŸçš„æ€ç»´è¿›åŒ–ç³»ç»Ÿ | æœ¬åœ°æ•°æ®å·²å¯ç”¨</div>
    </footer>

    <div class="modal-overlay" id="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title" id="m-title">Day X</div>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="section-label">ğŸ¯ ä»Šæ—¥å®æˆ˜ (Daily Task)</div>
                <div class="task-box">
                    <div id="m-task" style="margin-bottom:10px;">...</div>
                </div>
                <div class="example-box">
                    <div style="color:var(--gold); font-weight:bold; margin-bottom:4px;">ğŸ’¡ æŠ€å·§æç¤º:</div>
                    <div id="m-example" style="color:#aaa; white-space:pre-wrap;">...</div>
                </div>

                <div class="section-label" style="color: #a78bfa;">ğŸ—£ï¸ åˆç¨¿ (V1.0)</div>
                <textarea id="m-input" class="homework-area" placeholder="ç‚¹å‡»éº¦å…‹é£ï¼Œå£è¿°ä½ çš„æƒ³æ³•..."></textarea>
                
                <button class="btn-ai-gen" onclick="generateAiPrompt()">
                    <span>âœ¨ å‘¼å« AI æ•™ç»ƒä¼˜åŒ–é€»è¾‘</span>
                </button>
                
                <div class="ai-prompt-box" id="ai-box">
                    <div style="color:#888; font-size:0.7rem; margin-bottom:8px;">æŒ‡ä»¤å·²ç”Ÿæˆï¼š</div>
                    <div class="ai-prompt-content" id="ai-prompt-text"></div>
                    <div class="btn-group">
                        <button class="btn-secondary" onclick="forceCopy(this)">ğŸ“‹ ä»…å¤åˆ¶</button>
                        <button class="btn-secondary" style="background:#fff; color:#000;" onclick="jumpToDoubao(this)">ğŸš€ å»è±†åŒ… APP</button>
                    </div>
                </div>

                <div class="section-label" style="color: var(--gold); margin-top:30px;">ğŸ† å¤§å¸ˆæˆå“ (V2.0)</div>
                <textarea id="m-revision" class="revision-area" placeholder="AI ä¼˜åŒ–åçš„é€»è¾‘ç‰ˆæœ¬..."></textarea>
                <div id="save-msg" style="text-align:right; color:#666; font-size:0.7rem; margin-top:4px;">å·²ä¿å­˜</div>

                <button class="btn-report" onclick="generateVisualReport()">
                    ğŸ“¸ ç”Ÿæˆå¯¹æ¯”æˆ˜æŠ¥
                </button>
                <div style="height:40px"></div>
            </div>
        </div>
    </div>

    <div class="report-overlay" id="report-overlay">
        <div class="report-close" onclick="closeReport()">Ã—</div>
        <img id="report-img" class="report-img" alt="Report">
        <div class="report-tip">é•¿æŒ‰å›¾ç‰‡ä¿å­˜ -> ç§€å‡ºä½ çš„é€»è¾‘</div>
    </div>
    <canvas id="canvas-buffer" width="1080" height="1440"></canvas>

    <script>
        // === æ ¸å¿ƒæ•°æ® ===
        const syllabus = {
            1: {
                title: "è§‚ç‚¹è®­ç»ƒï¼šè¯´äººè¯",
                goal: "æœ¬å‘¨ç›®æ ‡ï¼šä¸€å¥è¯è®²æ¸…æ¥šäº‹ (ä¿¡æ¯å‹ç¼© + è§‚ç‚¹è¾“å‡º)ï¼Œæ‹’ç»å•°å—¦ã€‚",
                days: [
                { day: 1, title: "æœ‰æ•ˆåæ§½", model: "SCQA-Conflict", task: "ã€åœºæ™¯ï¼šåæ§½ä¸€ä»¶çƒ¦å¿ƒäº‹ã€‘\nä»Šå¤©é‡åˆ°ä»€ä¹ˆä¸çˆ½çš„äº‹äº†ï¼Ÿè¯•ç€æŠŠå®ƒè¯´æ¸…æ¥šã€‚\nä¸è¦åªè¯´'æ°”æ­»æˆ‘äº†'ï¼Œè¦è¯´æ¸…æ¥šã€æœ¬æ¥åº”è¯¥æ˜¯æ€æ ·(S)ã€‘ï¼Œã€å®é™…å‘ç”Ÿäº†ä»€ä¹ˆå†²çª(C)ã€‘ï¼Œã€ä½ å¸Œæœ›æ€ä¹ˆè§£å†³(A)ã€‘ã€‚", example: "æŠ€å·§ï¼šç”¨ SCQA è®²æ•…äº‹ã€‚\næ¯”å¦‚ï¼š'æœ¬æ¥æˆ‘å’Œè€å…¬çº¦å¥½å»åƒé¥­(S)ï¼Œç»“æœä»–ä¸´æ—¶åŠ ç­(C)ï¼Œæˆ‘å¾ˆå¤±è½ï¼Œå¸Œæœ›ä¸‹æ¬¡èƒ½è¡¥ä¸Š(A)ã€‚'", template: "æœ¬æ¥æ˜¯ï¼š\nä½†æ˜¯ï¼š\næ‰€ä»¥æˆ‘æƒ³ï¼š" },
                { day: 2, title: "ç–¯ç‹‚å®‰åˆ©", model: "SCQA-Answer", task: "ã€åœºæ™¯ï¼šå®‰åˆ©ä¸€æ¬¾å¥½ç‰©/å‰§ã€‘\nå‘é—ºèœœæ¨èä¸€ä¸ªä½ æœ€è¿‘çˆ±ç”¨çš„ä¸œè¥¿ã€‚\nå…ˆç›´æ¥è¯´ã€å®ƒæœ‰å¤šå¥½(A)ã€‘ï¼Œå†è¯´ã€å¤§å®¶å¹³æ—¶çš„ç—›ç‚¹(C)ã€‘ï¼Œæœ€åè¯´ã€ä¸ºä»€ä¹ˆå®ƒèƒ½è§£å†³(Q-A)ã€‘ã€‚", example: "æŠ€å·§ï¼šç»“è®ºå…ˆè¡Œ(A-S-C-Q)ã€‚\næ¯”å¦‚ï¼š'è¿™æ¬¾é¢éœœç»äº†(A)ï¼ä»¥å‰æˆ‘è„¸æ€»å¹²(C)ï¼Œç”¨äº†å¾ˆå¤šéƒ½ä¸è¡Œï¼Œç›´åˆ°ç”¨äº†å®ƒ(S)...'", template: "æˆ‘è¦å¹çˆ†è¿™ä¸ªï¼š\nå¤§å®¶å¹³æ—¶æ˜¯ä¸æ˜¯æ€»ï¼š\nä½†å®ƒèƒ½ï¼š" },
                { day: 3, title: "è‡ªæˆ‘ä»‹ç»", model: "SCQA-Intro", task: "ã€åœºæ™¯ï¼šæ–°ç¾¤ç ´å†°ã€‘\nè¿›å…¥ä¸€ä¸ªæ–°çš„ç¤¾ç¾¤ï¼Œåšä¸€ä¸ªè®©äººè®°ä½çš„è‡ªæˆ‘ä»‹ç»ã€‚\nåˆ«åªæŠ¥åå­—ï¼Œè¯´è¯´ã€ä½ æ˜¯è°(S)ã€‘ï¼Œã€ä½ æ­£åœ¨ç»å†ä»€ä¹ˆæŒ‘æˆ˜/æ¢ç´¢(C)ã€‘ï¼Œã€ä½ èƒ½ç»™å¤§å®¶å¸¦æ¥ä»€ä¹ˆ(A)ã€‘ã€‚", example: "æŠ€å·§ï¼šç”¨æ•…äº‹åŒ…è£…èº«ä»½ã€‚\næ¯”å¦‚ï¼š'æˆ‘æ˜¯å¸¦å¨ƒ5å¹´çš„å®å¦ˆ(S)ï¼Œä¸æƒ³ä¸ç¤¾ä¼šè„±èŠ‚(C)ï¼Œç°åœ¨æ­£åœ¨å­¦ä¹ AIå†™ä½œ(A)ã€‚'", template: "æˆ‘æ˜¯è°ï¼š\næˆ‘æ­£åœ¨é¢ä¸´/æ¢ç´¢ï¼š\næˆ‘èƒ½åˆ†äº«ï¼š" },
                { day: 4, title: "é«˜æƒ…å•†æ‹’ç»", model: "SCQA-Refuse", task: "ã€åœºæ™¯ï¼šæ‹’ç»ä¸åˆç†è¦æ±‚ã€‘\næœ‹å‹å€Ÿé’±ã€åŒäº‹ç”©é”…ï¼Ÿè¯•ç€å§”å©‰ä½†åšå®šåœ°æ‹’ç»ã€‚\nå…ˆã€è‚¯å®šå¯¹æ–¹/è¡¨ç¤ºæ„Ÿè°¢(S)ã€‘ï¼Œå†è¯´ã€è‡ªå·±çš„éš¾å¤„(C)ã€‘ï¼Œæœ€åã€ç»™ä¸ªå°é˜¶/æ›¿ä»£æ–¹æ¡ˆ(A)ã€‘ã€‚", example: "æŠ€å·§ï¼šS(ç¼“å†²)-C(ç†ç”±)-A(æ‹’ç»)ã€‚\næ¯”å¦‚ï¼š'è°¢è°¢ä½ æƒ³åˆ°æˆ‘(S)ï¼Œä½†æˆ‘æœ€è¿‘æ‰‹å¤´ä¹Ÿç´§(C)ï¼Œç¡®å®æ²¡æ³•å€Ÿï¼ŒæŠ±æ­‰å•Š(A)ã€‚'", template: "è°¢è°¢ä½ ï¼š\nä½†æ˜¯æˆ‘ç°åœ¨ï¼š\næ‰€ä»¥æ¯”è¾ƒæŠ±æ­‰ï¼š" },
                { day: 5, title: "å‘æœ‹å‹åœˆ", model: "SCQA-Moment", task: "ã€åœºæ™¯ï¼šè®°å½•ç”Ÿæ´»æ„Ÿæ‚Ÿã€‘\nå‘ä¸€æ¡æœ‰æ·±åº¦çš„æœ‹å‹åœˆã€‚\nå…ˆæè¿°ã€ä¸€ä¸ªç°è±¡(S)ã€‘ï¼Œå†æŒ‡å‡ºã€å¤§å¤šæ•°äººçš„è¯¯åŒº(C)ã€‘ï¼Œæœ€åäº®å‡ºã€ä½ çš„ç‹¬ç‰¹è§‚ç‚¹(A)ã€‘ã€‚", example: "æŠ€å·§ï¼šåˆ¶é€ åå·®ã€‚\næ¯”å¦‚ï¼š'å¤§å®¶éƒ½è§‰å¾—èººå¹³å¾ˆçˆ½(S)ï¼Œå…¶å®èººå¹³æ›´ç„¦è™‘(C)ï¼ŒçœŸæ­£çš„æ¾å¼›æ„Ÿæ˜¯æŒæ§åŠ›(A)ã€‚'", template: "å¤§å®¶é€šå¸¸è§‰å¾—ï¼š\nä½†å…¶å®ï¼š\næˆ‘è®¤ä¸ºï¼š" },
                { day: 6, title: "å“„äºº/æ±‚å’Œ", model: "SCQA-Peace", task: "ã€åœºæ™¯ï¼šè§£å†³å†·æˆ˜ã€‘\næƒ¹äººç”Ÿæ°”äº†æ€ä¹ˆå“„ï¼Ÿ\nå…ˆæ‰¿è®¤ã€æˆ‘ä»¬çš„å…³ç³»å¾ˆé‡è¦(S)ã€‘ï¼Œå†æ‰¿è®¤ã€åˆšæ‰çš„é—®é¢˜(C)ã€‘ï¼Œæœ€åæå‡ºã€è¡¥æ•‘æªæ–½(A)ã€‘ã€‚", example: "æŠ€å·§ï¼šS(å…±åŒç›®æ ‡)-C(ç¡®è®¤å†²çª)-A(è¡ŒåŠ¨)ã€‚\næ¯”å¦‚ï¼š'æˆ‘ä»¬åˆ«åµäº†(S)ï¼Œåˆšæ‰æ˜¯æˆ‘è¯­æ°”é‡äº†(C)ï¼Œå¸¦ä½ å»åƒç«é”…å§(A)ã€‚'", template: "æˆ‘ä»¬æœ¬æ„æ˜¯ï¼š\nåˆšæ‰ç¡®å®ï¼š\nä¸å¦‚æˆ‘ä»¬ï¼š" },
                { day: 7, title: "æœ¬å‘¨å¤ç›˜", model: "Review", task: "ã€åœºæ™¯ï¼šè·Ÿè‡ªå·±å¯¹è¯ã€‘\nè¿™å‘¨è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ\nã€S:è®¡åˆ’ã€‘vsã€C:å®é™…å˜åŒ–ã€‘vsã€A:ä¸‹å‘¨è°ƒæ•´ã€‘ã€‚", example: "æŠ€å·§ï¼šSCQAå¤ç›˜æ³•ã€‚", template: "æœ¬å‘¨åŸæœ¬è®¡åˆ’ï¼š\nä¸­é—´é‡åˆ°äº†ï¼š\nä¸‹å‘¨å†³å®šï¼š" }
            ]},
            2: {
                title: "ç»“æ„è®­ç»ƒï¼šæœ‰é€»è¾‘",
                goal: "æœ¬å‘¨ç›®æ ‡ï¼šæ­å»ºæ€ç»´éª¨æ¶ï¼Œè®©è¡¨è¾¾ç«™å¾—ä½è„šï¼Œä¸å†è¯­æ— ä¼¦æ¬¡ã€‚",
                days: [
                { day: 8, title: "åˆ—æ¸…å•", model: "Structure-List", task: "ã€åœºæ™¯ï¼šå‘¨æœ«è®¡åˆ’ã€‘\nè¿™ä¸ªå‘¨æœ«æƒ³åšä»€ä¹ˆï¼Ÿä¸è¦ä¹±æƒ³ï¼Œåˆ—å‡º 3 ä»¶äº‹ã€‚\næŠ€å·§ï¼šè¿™å°±æ˜¯â€œå½’çº³æ³•â€ã€‚", example: "1. ä¼‘æ¯ç±»ï¼ˆç¡æ‡’è§‰ï¼‰\n2. ç¤¾äº¤ç±»ï¼ˆèšé¤ï¼‰\n3. å­¦ä¹ ç±»ï¼ˆçœ‹ä¹¦ï¼‰", template: "å‘¨æœ«æˆ‘æƒ³åšä¸‰ä»¶äº‹ï¼š\n1.\n2.\n3." },
                { day: 9, title: "åšé€‰æ‹©", model: "Structure-Choice", task: "ã€åœºæ™¯ï¼šä¹°ä¸ä¹°ï¼Ÿã€‘\nçœ‹ä¸­äº†ä¸€ä¸ªè´µä¸œè¥¿ï¼Œçº ç»“ä¹°ä¸ä¹°ï¼Ÿ\nåˆ—å‡ºã€ä¹°çš„ç†ç”±ã€‘vsã€ä¸ä¹°çš„ç†ç”±ã€‘ï¼Œæœ€åç»™ç»“è®ºã€‚", example: "æŠ€å·§ï¼šæ­£åè®ºè¯ã€‚\næ­£é¢ï¼šåˆ©ç”¨ç‡é«˜ï¼›åé¢ï¼šè¶…é¢„ç®—ã€‚", template: "æˆ‘æƒ³ä¹°ï¼š\næ”¯æŒç†ç”±ï¼š\nåå¯¹ç†ç”±ï¼š\næœ€ç»ˆå†³å®šï¼š" },
                { day: 10, title: "æ•™åˆ«äºº", model: "Structure-Steps", task: "ã€åœºæ™¯ï¼šæ•™çˆ¸å¦ˆç”¨æ‰‹æœº/åšèœã€‘\nè¦æŠŠä¸€ä¸ªæ­¥éª¤è®²æ¸…æ¥šã€‚\nç”¨â€œç¬¬ä¸€æ­¥ã€ç¬¬äºŒæ­¥ã€ç¬¬ä¸‰æ­¥â€çš„é¡ºåºã€‚", example: "æŠ€å·§ï¼šæ—¶é—´é¡ºåºã€‚\n1. å…ˆæ‰“å¼€è®¾ç½®ï¼›2. å†ç‚¹æ˜¾ç¤ºï¼›3. è°ƒå¤§å­—ä½“ã€‚", template: "æ•™ä½ åš/ç”¨è¿™ä¸ªï¼š\nç¬¬ä¸€æ­¥ï¼š\nç¬¬äºŒæ­¥ï¼š\nç¬¬ä¸‰æ­¥ï¼š" },
                { day: 11, title: "è°ˆåŠ è–ª/è°ˆæ¡ä»¶", model: "Structure-Value", task: "ã€åœºæ™¯ï¼šè°ˆåˆ©ç›Šã€‘\næƒ³è®©è€å…¬åšå®¶åŠ¡ï¼Ÿæˆ–è€…è·Ÿè€æ¿è°ˆèµ„æºï¼Ÿ\nå‘Šè¯‰ä»–ï¼šè¿™æ ·åšã€å¯¹ä½ æœ‰ä»€ä¹ˆå¥½å¤„(WIIFM)ã€‘ã€‚", example: "æŠ€å·§ï¼šåˆ©ç›Šé©±åŠ¨ã€‚\n'è€å…¬ä½ æŠŠåœ°æ‰«äº†ï¼Œæˆ‘å°±èƒ½è…¾å‡ºæ‰‹ç»™ä½ åšçº¢çƒ§è‚‰äº†ã€‚'", template: "æˆ‘æƒ³è®©ä½ åšï¼š\nè¿™æ ·åšå¯¹ä½ çš„å¥½å¤„æ˜¯ï¼š" },
                { day: 12, title: "è¯„ä»·äº‹ç‰©", model: "Structure-Aspects", task: "ã€åœºæ™¯ï¼šè¯„ä»·ä¸€ä¸ªé¤å…/ç”µå½±ã€‘\nä¸è¦åªè¯´â€œå¥½åƒ/å¥½çœ‹â€ã€‚\nè¯•ç€ä» 3 ä¸ªç»´åº¦è¯„ä»·ï¼ˆå¦‚ï¼šç¯å¢ƒã€æœåŠ¡ã€å£å‘³ï¼‰ã€‚", example: "æŠ€å·§ï¼šç»“æ„åŒ–æ€ç»´(MECE)ã€‚", template: "è¯„ä»·ï¼š\n1. ç»´åº¦ä¸€ï¼š\n2. ç»´åº¦äºŒï¼š\n3. ç»´åº¦ä¸‰ï¼š" },
                { day: 13, title: "è®²é“ç†", model: "Structure-Logic", task: "ã€åœºæ™¯ï¼šè¯´æœåˆ«äººã€‘\nç”¨â€œå› ä¸º...æ‰€ä»¥...â€çš„é€»è¾‘è¯´æœä¸€ä¸ªäººã€‚\næ¯”å¦‚åŠäººæ—©ç¡ï¼ŒåŠäººè¯»ä¹¦ã€‚", example: "æŠ€å·§ï¼šæ¼”ç»æ¨ç†ã€‚\n'ç†¬å¤œä¼šå˜ä¸‘(å¤§å‰æ)ï¼Œä½ ä¸æƒ³å˜ä¸‘(å°å‰æ)ï¼Œæ‰€ä»¥ä½ è¦æ—©ç¡(ç»“è®º)ã€‚'", template: "æˆ‘å»ºè®®ä½ ï¼š\nå› ä¸ºä¸€ï¼š\nå› ä¸ºäºŒï¼š\næ‰€ä»¥ï¼š" },
                { day: 14, title: "ç»“æ„åŒ–æ€»ç»“", model: "Review", task: "ã€åœºæ™¯ï¼šå‘¨è®°ã€‘\nç”¨â€œæ€»-åˆ†â€ç»“æ„å†™è¿™å‘¨çš„æ€»ç»“ã€‚\nå…ˆè¯´ä¸€ä¸ªæ ¸å¿ƒè¯ï¼Œå†è¯´ä¸‰ä»¶å°äº‹ã€‚", example: "æ ¸å¿ƒè¯ï¼šå¿™ç¢Œã€‚\n1. å·¥ä½œå¿™ï¼›2. å®¶é‡Œå¿™ï¼›3. å¿ƒé‡Œå¿™ã€‚", template: "æœ¬å‘¨å…³é”®è¯ï¼š\nå…·ä½“è¡¨ç°1ï¼š\nå…·ä½“è¡¨ç°2ï¼š\nå…·ä½“è¡¨ç°3ï¼š" }
            ]},
            3: {
                title: "æ´å¯Ÿè®­ç»ƒï¼šé«˜çº§æ„Ÿ",
                goal: "æœ¬å‘¨ç›®æ ‡ï¼šé€è¿‡ç°è±¡çœ‹æœ¬è´¨ï¼Œç”¨ç±»æ¯”å’Œé‡‘å¥è®©ä½ çš„è¡¨è¾¾é—ªé—ªå‘å…‰ã€‚",
                days: [
                { day: 15, title: "æ‰“æ¯”æ–¹", model: "Analogy-Life", task: "ã€åœºæ™¯ï¼šè§£é‡Šå¿ƒæƒ…ã€‘\nä½ ç°åœ¨æ˜¯ä»€ä¹ˆå¿ƒæƒ…ï¼Ÿ\nè¯•ç€ç”¨â€œå°±åƒ......â€æ¥å½¢å®¹å®ƒã€‚", example: "æŠ€å·§ï¼šç±»æ¯”ã€‚\n'æˆ‘ç´¯å¾—å°±åƒä¸€æ¡åˆšè·‘å®Œé©¬æ‹‰æ¾çš„ç‹—ã€‚'", template: "æˆ‘ç°åœ¨æ„Ÿè§‰ï¼š\nå°±åƒï¼š" },
                { day: 16, title: "è®²æ•…äº‹", model: "Story-Moment", task: "ã€åœºæ™¯ï¼šåˆ†äº«ç»å†ã€‘\nè®²ä¸€ä¸ªä½ è¿‡å»çš„â€œé«˜å…‰æ—¶åˆ»â€æˆ–â€œè‡³æš—æ—¶åˆ»â€ã€‚\nè¦æœ‰ç”»é¢æ„Ÿã€‚", example: "æŠ€å·§ï¼šSTARæ³•åˆ™ï¼ˆæƒ…å¢ƒ-ä»»åŠ¡-è¡ŒåŠ¨-ç»“æœï¼‰ã€‚", template: "é‚£æ˜¯ä¸€æ¬¡ï¼š\nå½“æ—¶æƒ…å†µæ˜¯ï¼š\næˆ‘åšäº†ï¼š\næœ€åï¼š" },
                { day: 17, title: "è¯´é‡‘å¥", model: "Golden-Word", task: "ã€åœºæ™¯ï¼šé¼“åŠ±æœ‹å‹ã€‘\næœ‹å‹emoäº†ï¼Œé€ä»–ä¸€å¥æœ‰åŠ›é‡çš„è¯ã€‚\nè¯•ç€æŠ¼éŸµï¼Œæˆ–è€…ç”¨å¯¹æ¯”ã€‚", example: "æŠ€å·§ï¼šé‡‘å¥æç‚¼ã€‚\n'ä¸‡ç‰©çš†æœ‰è£‚ç—•ï¼Œé‚£æ˜¯å…‰ç…§è¿›æ¥çš„åœ°æ–¹ã€‚'", template: "æƒ³å¯¹ä½ è¯´ï¼š\n" },
                { day: 18, title: "ç¥é¢„è¨€", model: "Insight-Future", task: "ã€åœºæ™¯ï¼šèŠè¶‹åŠ¿ã€‘\nèŠèŠä½ å¯¹æŸä¸ªè¡Œä¸šï¼ˆå¦‚AIã€çŸ­è§†é¢‘ï¼‰çš„çœ‹æ³•ã€‚\nç”¨â€œæˆ‘è®¤ä¸ºæœªæ¥......â€å¼€å¤´ã€‚", example: "æŠ€å·§ï¼šæ´å¯ŸåŠ›ã€‚", template: "å…³äºè¿™ä¸ªè¡Œä¸šï¼š\næˆ‘è®¤ä¸ºæœªæ¥ä¼šï¼š" },
                { day: 19, title: "æ‰å¿ƒçœŸç›¸", model: "Insight-Truth", task: "ã€åœºæ™¯ï¼šæ­éœ²æœ¬è´¨ã€‘\né€è¿‡ç°è±¡çœ‹æœ¬è´¨ã€‚\nâ€œè¡¨é¢ä¸Šæ˜¯Aï¼Œå®é™…ä¸Šæ˜¯Bâ€ã€‚", example: "æŠ€å·§ï¼šæ·±åº¦æ€è€ƒã€‚\n'è¡¨é¢ä¸Šæ˜¯æ‹–å»¶ï¼Œå®é™…ä¸Šæ˜¯ææƒ§å¤±è´¥ã€‚'", template: "è¡¨é¢ä¸Šï¼š\nå®é™…ä¸Šï¼š" },
                { day: 20, title: "è¡ŒåŠ¨å·å¬", model: "Call-Action", task: "ã€åœºæ™¯ï¼šçº¦äººã€‘\nçº¦æœ‹å‹å‡ºæ¥ç©ï¼Œæˆ–è€…å·å¬å¤§å®¶ä¸€èµ·åšä»¶äº‹ã€‚\nç»™å‡ºä¸€ä¸ªæ— æ³•æ‹’ç»çš„ç†ç”±ã€‚", example: "æŠ€å·§ï¼šCTA (Call To Action)ã€‚", template: "æˆ‘ä»¬ä¸€èµ·å»ï¼š\nå¦‚æœä¸å»ä¼šåæ‚”ï¼Œå› ä¸ºï¼š" },
                { day: 21, title: "æ¯•ä¸šæ„Ÿè¨€", model: "Final-Speech", task: "ã€åœºæ™¯ï¼šå®Œç»“æ’’èŠ±ã€‘\n21å¤©ç»“æŸäº†ï¼Œå¯¹è‡ªå·±è¯´ä¸€æ®µè¯ã€‚\nç”¨ä¸ŠSCQAï¼ŒåŠ ä¸Šæ’æ¯”å¥ã€‚", example: "S(å¼€å§‹å¾ˆéš¾)-C(ä¸­é—´å¾ˆç´¯)-A(ä½†æˆ‘åšæŒä¸‹æ¥äº†)ã€‚", template: "å¯¹è‡ªå·±è¯´ï¼š" }
            ]}
        };

        let currentWeek = 1;
        const DB_KEY_PROG = 'zhouzhou_life_prog'; 
        const DB_KEY_INPUT = 'zhouzhou_life_input';
        const DB_KEY_REV = 'zhouzhou_life_rev';

        // æ ¸å¿ƒä¿®å¤ï¼šé˜²æ­¢ localStorage æŠ¥é”™å¯¼è‡´ç™½å±
        function safeGet(key) {
            try { return JSON.parse(localStorage.getItem(key)); } catch(e) { return null; }
        }
        function safeSet(key, val) {
            try { localStorage.setItem(key, JSON.stringify(val)); } catch(e) {}
        }

        let completedDays = safeGet(DB_KEY_PROG) || [];
        let userInputs = safeGet(DB_KEY_INPUT) || {};
        let userRevisions = safeGet(DB_KEY_REV) || {};
        
        let activeDayId = null;
        let activeWeekId = 1;

        function init() { renderContent(); updateProgress(); }

        function renderContent() {
            const container = document.getElementById('content-area');
            container.innerHTML = '';
            
            const weekData = syllabus[currentWeek];
            const banner = document.getElementById('week-banner');
            banner.innerHTML = `
                <div class="banner-tag">WEEK 0${currentWeek}</div>
                <div class="banner-title">${weekData.title}</div>
                <div class="banner-desc">${weekData.goal}</div>
            `;
            
            banner.style.animation = 'none';
            banner.offsetHeight; 
            banner.style.animation = 'slideUp 0.4s ease-out';

            let html = `<div class="grid active">`;
            weekData.days.forEach(d => {
                const isDone = completedDays.includes(d.day);
                const dayLabel = d.day < 10 ? `0${d.day}` : d.day;
                html += `
                    <div class="card ${isDone ? 'completed' : ''}" onclick="openModal(${currentWeek}, ${d.day})">
                        <div class="card-left">
                            <div class="day-badge">DAY ${dayLabel}</div>
                            <div class="card-title">${d.task.split('\n')[0]}</div>
                        </div>
                        <div class="check-area" onclick="toggleComplete(event, ${d.day})">
                            <div class="check-icon"></div>
                        </div>
                    </div>`;
            });
            html += `</div>`;
            container.innerHTML = html;
        }

        function switchWeek(weekNum) {
            currentWeek = weekNum;
            document.querySelectorAll('.nav-item').forEach((btn, idx) => {
                btn.className = (idx + 1 === weekNum) ? 'nav-item active' : 'nav-item';
            });
            renderContent();
        }

        function toggleComplete(event, dayId) {
            event.stopPropagation(); 
            const idx = completedDays.indexOf(dayId);
            if (idx > -1) completedDays.splice(idx, 1);
            else completedDays.push(dayId);
            safeSet(DB_KEY_PROG, completedDays);
            updateProgress();
            renderContent(); 
        }

        function updateProgress() {
            const pct = Math.round((completedDays.length / 21) * 100);
            document.getElementById('progress-bar').style.width = pct + '%';
            document.getElementById('progress-text').innerText = pct + '%';
        }

        function openModal(week, dayId) {
            const data = syllabus[week].days.find(d => d.day === dayId);
            if (!data) return;
            activeDayId = dayId;
            activeWeekId = week;
            
            document.getElementById('m-title').innerText = `Day ${dayId} | ${data.title}`;
            document.getElementById('m-task').innerText = data.task;
            document.getElementById('m-example').innerText = data.example;
            
            const inputArea = document.getElementById('m-input');
            const revArea = document.getElementById('m-revision');
            
            inputArea.value = userInputs[dayId] || data.template;
            revArea.value = userRevisions[dayId] || "";

            document.getElementById('ai-box').style.display = 'none';
            document.getElementById('modal').classList.add('open');
        }

        document.getElementById('m-input').addEventListener('input', function(e) {
            if (!activeDayId) return;
            userInputs[activeDayId] = e.target.value;
            safeSet(DB_KEY_INPUT, userInputs);
            document.getElementById('save-msg').innerText = "åˆç¨¿å·²ä¿å­˜";
        });

        document.getElementById('m-revision').addEventListener('input', function(e) {
            if (!activeDayId) return;
            userRevisions[activeDayId] = e.target.value;
            safeSet(DB_KEY_REV, userRevisions);
            document.getElementById('save-msg').innerText = "æˆå“å·²ä¿å­˜";
        });

        function generateAiPrompt() {
            const inputVal = document.getElementById('m-input').value;
            const dayData = syllabus[activeWeekId].days.find(d => d.day === activeDayId);
            const templateText = dayData.template.trim();
            const currentText = inputVal ? inputVal.trim() : "";

            if (!currentText || currentText.length < 5 || currentText === templateText) {
                alert("âš ï¸ è¯·å…ˆå†™ç‚¹ä¸œè¥¿ï¼ˆæ”¯æŒè¯­éŸ³è¾“å…¥ï¼‰ï¼\nä¸èƒ½äº¤ç™½å·å“¦ã€‚");
                return;
            }

            const prompt = `æˆ‘æ­£åœ¨å‚åŠ ã€Šç»“æ„åŒ–è¡¨è¾¾å®æˆ˜è¥ã€‹ï¼Œè¯·ä½ æ‰®æ¼”ä¸€ä½é«˜æƒ…å•†ã€é€»è¾‘æ¸…æ™°çš„æ²Ÿé€šæ•™ç»ƒã€‚

ã€ä»Šæ—¥ç”Ÿæ´»åœºæ™¯ã€‘ï¼š${dayData.title}
ã€ä»»åŠ¡è¦æ±‚ã€‘ï¼š${dayData.task.replace(/\n/g, " ")}

ã€æˆ‘çš„å£è¿°/åˆç¨¿ã€‘ï¼š
${inputVal}

ã€è¯·å¸®æˆ‘åšä¸¤ä»¶äº‹ï¼ˆä¸è¦è®²å¤§é“ç†ï¼Œç›´æ¥ä¸Šå¹²è´§ï¼‰ã€‘ï¼š

1. ğŸ©º é€»è¾‘è¯Šæ–­ï¼š
   - æˆ‘è¯´æ¸…æ¥šäº†å—ï¼Ÿ
   - æ˜¯å¦ç¬¦åˆä»Šæ—¥çš„æŠ€å·§ï¼ˆæ¯”å¦‚æœ‰æ²¡æœ‰ç”¨ä¸ŠSCQAï¼Œæˆ–è€…é€»è¾‘é¡ºä¸é¡ºï¼‰ï¼Ÿ
   - ç»™æˆ‘æ‰“ä¸ªåˆ†ï¼ˆ0-10åˆ†ï¼‰ã€‚

2. âœ¨ é«˜æƒ…å•†/é«˜é€»è¾‘é‡å†™ï¼ˆæ¼”ç¤ºï¼‰ï¼š
   - è¯·è¿ç”¨ç»“æ„åŒ–æ€ç»´ï¼ˆSCQA/æ€»åˆ†æ€»/ç±»æ¯”ï¼‰ï¼Œå¸®æˆ‘æŠŠè¿™æ®µè¯é‡å†™ä¸€éã€‚
   - è¦æ±‚ï¼šå£è¯­åŒ–ã€è‡ªç„¶ã€èƒ½ç›´æ¥å‘æœ‹å‹åœˆæˆ–ç›´æ¥è¯´ç»™åˆ«äººå¬ã€‚

è¯·ç›´æ¥è¾“å‡ºç»“æœã€‚`;

            document.getElementById('ai-prompt-text').innerText = prompt;
            document.getElementById('ai-box').style.display = 'block';
            setTimeout(() => {
                const modalBody = document.querySelector('.modal-body');
                modalBody.scrollTo({ top: modalBody.scrollHeight, behavior: 'smooth' });
            }, 100);
        }

        // === å¼ºåŠ›å¤åˆ¶ ===
        function forceCopy(btnElement) {
            const text = document.getElementById('ai-prompt-text').innerText;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                    .then(() => showSuccess(btnElement))
                    .catch(() => fallbackCopy(text, btnElement));
            } else { fallbackCopy(text, btnElement); }
        }

        function jumpToDoubao(btnElement) {
            const text = document.getElementById('ai-prompt-text').innerText;
            try {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showSuccess(btnElement);
            } catch(e) {}
            window.location.href = "https://www.doubao.com/chat/";
        }

        function fallbackCopy(text, btnElement) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; textArea.style.left = "0"; textArea.style.top = "0"; 
            textArea.style.opacity = "0"; textArea.setAttribute("readonly", "");
            document.body.appendChild(textArea);
            if (navigator.userAgent.match(/ipad|iphone/i)) {
                const range = document.createRange(); range.selectNodeContents(textArea);
                const selection = window.getSelection(); selection.removeAllRanges(); selection.addRange(range);
                textArea.setSelectionRange(0, 999999);
            } else { textArea.select(); }
            try {
                const successful = document.execCommand('copy');
                if(successful) showSuccess(btnElement);
                else throw new Error("cmd fail");
            } catch (e) {
                window.prompt("è¯·æ‰‹åŠ¨å…¨é€‰å¤åˆ¶æŒ‡ä»¤ï¼š", text);
            }
            document.body.removeChild(textArea);
        }

        function showSuccess(btn) {
            const originalText = btn.innerHTML;
            btn.innerHTML = "âœ… å·²å¤åˆ¶";
            btn.classList.add("success");
            setTimeout(() => { btn.innerHTML = originalText; btn.classList.remove("success"); }, 2000);
        }

        // === ä¿®å¤ç‰ˆï¼šåŒç™¾å¶çª—å¯¹æ¯”æˆ˜æŠ¥ ===
        function generateVisualReport() {
            const revVal = document.getElementById('m-revision').value.trim();
            const inputVal = document.getElementById('m-input').value.trim();
            
            if (revVal.length < 2 && inputVal.length < 2) {
                alert("è¯·å…ˆå†™ç‚¹ä¸œè¥¿å†ç”Ÿæˆæˆ˜æŠ¥å“¦ï¼");
                return;
            }

            const canvas = document.getElementById('canvas-buffer');
            const ctx = canvas.getContext('2d');
            const W = 1080;
            const paddingX = 60; // å·¦å³è¾¹è·
            const textX = 100;   // æ–‡å­—èµ·å§‹X
            const textWidth = W - 200;
            const lineHeight = 60;
            const labelHeight = 80;
            const boxPadding = 60; // ç›’å­å†…è¾¹è·

            // 1. é¢„è®¡ç®—é«˜åº¦
            ctx.font = "36px 'Noto Sans SC'";

            // åˆç¨¿é«˜åº¦
            const draftLines = calculateTextLines(ctx, inputVal || "ï¼ˆæœªå¡«å†™ï¼‰", textWidth);
            const draftTextHeight = draftLines.length * lineHeight;
            const draftBoxHeight = draftTextHeight + boxPadding * 2;
            const draftSectionHeight = labelHeight + draftBoxHeight;

            // è¿›åŒ–ç¨¿é«˜åº¦ (å¦‚æœæœ‰)
            let masterSectionHeight = 0;
            let masterLines = [];
            let masterBoxHeight = 0;
            const hasMaster = revVal.length > 2;
            
            if (hasMaster) {
                masterLines = calculateTextLines(ctx, revVal, textWidth);
                const masterTextHeight = masterLines.length * lineHeight;
                masterBoxHeight = masterTextHeight + boxPadding * 2;
                masterSectionHeight = labelHeight + masterBoxHeight;
            }

            const headerHeight = 480;
            const footerHeight = 150;
            const gap = 60; // ä¸¤ä¸ªåŒºå—çš„é—´è·

            // æ€»é«˜åº¦è®¡ç®—
            let H = headerHeight + draftSectionHeight + footerHeight;
            if (hasMaster) {
                H += gap + masterSectionHeight;
            }
            if (H < 1440) H = 1440; // æœ€å°é«˜åº¦å…œåº•

            // 2. è®¾ç½®ç”»å¸ƒ
            canvas.height = H;

            // 3. ç»˜åˆ¶èƒŒæ™¯
            const grd = ctx.createLinearGradient(0, 0, 0, H);
            grd.addColorStop(0, "#0f172a"); grd.addColorStop(1, "#020617");
            ctx.fillStyle = grd; ctx.fillRect(0, 0, W, H);
            
            ctx.strokeStyle = "#1e293b"; ctx.lineWidth = 2;
            for(let i=0; i<H; i+=60) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(W,i); ctx.stroke(); }

            // 4. ç»˜åˆ¶å¤´éƒ¨
            let taskTitle = "";
            for(let p=1; p<=3; p++) {
                const d = syllabus[p].days.find(i => i.day === activeDayId);
                if(d) taskTitle = d.title;
            }

            ctx.fillStyle = "#3b82f6"; ctx.font = "bold 40px 'JetBrains Mono'"; ctx.fillText("EVOLUTION LOG", 60, 100);
            ctx.fillStyle = "#fff"; ctx.font = "900 200px 'JetBrains Mono'"; ctx.fillText(activeDayId < 10 ? `0${activeDayId}` : `${activeDayId}`, 50, 320);
            ctx.fillStyle = "#94a3b8"; ctx.font = "bold 50px 'Noto Sans SC'"; ctx.fillText(`ç”Ÿæ´»å®æˆ˜ | ${taskTitle}`, 60, 420);

            // 5. ç»˜åˆ¶åˆç¨¿åŒº
            let currentY = headerHeight;

            // æ ‡ç­¾
            ctx.fillStyle = "#94a3b8"; 
            ctx.font = "bold 32px 'Noto Sans SC'";
            ctx.fillText("ğŸ“ åŸå§‹è®°å½• (V1.0)", paddingX, currentY + 40);
            currentY += labelHeight;

            // ç›’å­èƒŒæ™¯
            ctx.fillStyle = "rgba(30, 41, 59, 0.5)";
            ctx.fillRect(paddingX, currentY, W - paddingX*2, draftBoxHeight);
            ctx.strokeStyle = "#334155";
            ctx.strokeRect(paddingX, currentY, W - paddingX*2, draftBoxHeight);

            // ç›’å­æ–‡å­—
            ctx.fillStyle = "#cbd5e1"; 
            ctx.font = "36px 'Noto Sans SC'";
            let textY = currentY + boxPadding + 10;
            draftLines.forEach(line => {
                ctx.fillText(line, textX, textY);
                textY += lineHeight;
            });

            currentY += draftBoxHeight + gap;

            // 6. ç»˜åˆ¶è¿›åŒ–åŒº (å¦‚æœæœ‰)
            if (hasMaster) {
                // æ ‡ç­¾
                ctx.fillStyle = "#f59e0b"; // é‡‘è‰²
                ctx.font = "bold 32px 'Noto Sans SC'";
                ctx.fillText("ğŸ† è¿›åŒ–ç‰ˆæœ¬ (V2.0)", paddingX, currentY + 40);
                currentY += labelHeight;

                // ç›’å­èƒŒæ™¯
                ctx.fillStyle = "rgba(245, 158, 11, 0.1)"; // é‡‘è‰²å¾®å…‰
                ctx.fillRect(paddingX, currentY, W - paddingX*2, masterBoxHeight);
                ctx.strokeStyle = "#f59e0b"; // é‡‘è¾¹
                ctx.strokeRect(paddingX, currentY, W - paddingX*2, masterBoxHeight);

                // ç›’å­æ–‡å­—
                ctx.fillStyle = "#ffffff"; // äº®ç™½å­—
                ctx.font = "36px 'Noto Sans SC'";
                textY = currentY + boxPadding + 10;
                masterLines.forEach(line => {
                    ctx.fillText(line, textX, textY);
                    textY += lineHeight;
                });
            }

            // 7. ç»˜åˆ¶åº•éƒ¨
            ctx.fillStyle = "#3b82f6"; ctx.font = "30px 'Noto Sans SC'"; ctx.fillText("#æ€ç»´è¡¨è¾¾è¿›åŒ–è®­ç»ƒè¥", 60, H - 60);
            
            document.getElementById('report-img').src = canvas.toDataURL("image/png");
            document.getElementById('report-overlay').classList.add('show');
        }

        // è‡ªåŠ¨æ¢è¡Œè¾…åŠ©å‡½æ•°
        function calculateTextLines(ctx, text, maxWidth) {
            const paragraphs = text.split('\n');
            let allLines = [];
            paragraphs.forEach(para => {
                let line = '';
                const words = para.split('');
                for (let n = 0; n < words.length; n++) {
                    const testLine = line + words[n];
                    if (ctx.measureText(testLine).width > maxWidth && n > 0) {
                        allLines.push(line);
                        line = words[n];
                    } else {
                        line = testLine;
                    }
                }
                allLines.push(line);
            });
            return allLines;
        }

        function closeReport() { document.getElementById('report-overlay').classList.remove('show'); }
        
        function copyDataString(btn) {
            const data = { prog: completedDays, data: userInputs, rev: userRevisions };
            const str = "LIFE_BACKUP::" + btoa(encodeURIComponent(JSON.stringify(data)));
            fallbackCopy(str, btn);
        }

        function pasteDataString() {
            const code = prompt("è¯·ç²˜è´´æ‚¨çš„å¤‡ä»½å£ä»¤ (ä»¥ LIFE_BACKUP:: å¼€å¤´)");
            if (!code) return;
            try {
                if (code.startsWith("LIFE_BACKUP::")) {
                    const cleanCode = code.replace("LIFE_BACKUP::", "");
                    const jsonString = decodeURIComponent(atob(cleanCode));
                    const data = JSON.parse(jsonString);
                    if (confirm("ç¡®å®šè¦æ¢å¤æ•°æ®å—ï¼Ÿå½“å‰è¿›åº¦å°†è¢«è¦†ç›–ã€‚")) {
                        completedDays = data.prog || [];
                        userInputs = data.data || {};
                        userRevisions = data.rev || {};
                        safeSet(DB_KEY_PROG, completedDays);
                        safeSet(DB_KEY_INPUT, userInputs);
                        safeSet(DB_KEY_REV, userRevisions);
                        init();
                        alert("ğŸ‰ æ•°æ®å·²æˆåŠŸæ¢å¤ï¼");
                    }
                } else { alert("âŒ å£ä»¤æ ¼å¼é”™è¯¯"); }
            } catch (e) { alert("âŒ æ•°æ®æŸå"); }
        }

        function resetData() {
            if(confirm("âš ï¸ è­¦å‘Šï¼šç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è¿›åº¦é‡æ–°å¼€å§‹å—ï¼Ÿ\n\næ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼å¦‚æœéœ€è¦ä¿ç•™æ•°æ®ï¼Œè¯·å…ˆç‚¹å‡»ã€å¤‡ä»½è¿›åº¦ã€‘ã€‚")) {
                try {
                    localStorage.removeItem(DB_KEY_PROG);
                    localStorage.removeItem(DB_KEY_INPUT);
                    localStorage.removeItem(DB_KEY_REV);
                } catch(e) {}
                location.reload();
            }
        }

        function closeModal(event) {
            if (!event || event.target.id === 'modal' || event.target.classList.contains('close-btn')) {
                document.getElementById('modal').classList.remove('open');
                activeDayId = null;
            }
        }

        init();
    </script>
</body>
</html>
